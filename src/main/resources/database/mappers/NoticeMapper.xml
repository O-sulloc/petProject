<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
    
<mapper namespace="com.pj.pet.board.notice.NoticeMapper">

	<!-- 전체 리스트 출력 -->
	<select id="getList" resultType="NoticeVO" parameterType="Pager">
		SELECT * FROM NOTICE
		WHERE NUM > 0
		AND
		<choose>
	    	<when test="kind == 'col1'">
	    		TITLE
	    	</when>
	    	<when test="kind == 'col2'">
	    		CONTENTS
	    	</when>
	    	<otherwise>
	    		ID
	    	</otherwise>
		</choose>
   		LIKE CONCAT('%',#{search},'%')
   		ORDER BY NUM DESC 
   		LIMIT #{startRow}, #{perPage}
	</select>

	<!-- paging 처리시 count -->
	<select id="getTotalCount" parameterType="Pager" resultType="Long" >
   		SELECT COUNT(NUM) FROM NOTICE
   		WHERE NUM>0
   		AND
   		<choose>
	    	<when test="kind == 'col1'">
	    		TITLE
	    	</when>
	    	<when test="kind == 'col2'">
	    		CONTENTS
	    	</when>
	    	<otherwise>
	    		ID
	    	</otherwise>
		</choose>
   		LIKE CONCAT('%',#{search},'%')
   	</select>

	<!-- 세부내용 출력 -->
	<select id="getDetail" resultMap="noticeCateDetail" parameterType="NoticeVO">
		SELECT N.*, NC.CATENAME FROM
			NOTICE N
		 		INNER JOIN
			NOTICECATE NC
			USING(GRADE)
		WHERE NUM = #{num}
	</select>

	<resultMap type="NoticeVO" id="noticeCateDetail">
	
		<id column="num" property="num"/>
		<result column="id" property="id"/>
		<result column="grade" property="grade"/>
		<result column="title" property="title"/>
		<result column="contents" property="contents"/>
		<result column="regDate" property="regDate"/>
		<association property="noticeCateVO" javaType="NoticeCateVO">
			<id column="grade" property="grade"/>
			<result column="cateName" property="cateName"/>
		</association>
		
	</resultMap>



	<!-- 공지사항 등록 -->
	<insert id="setAdd" parameterType="NoticeVO" useGeneratedKeys="true"  keyProperty="num">
		INSERT INTO NOTICE(NUM, ID, TITLE, CONTENTS, REGDATE, GRADE)
		VALUES(#{num}, #{id}, #{title}, #{contents}, now(), #{grade})
	</insert>

	<!-- 공지사항 수정 -->
	<update id="setUpdate" parameterType="NoticeVO">
		UPDATE NOTICE SET TITLE = #{title}, CONTENTS = #{contents}, GRADE = #{grade} WHERE ID = #{id}
	</update>
	
	
	<!-- 공지사항 삭제 -->
	<delete id="setDelete" parameterType="NoticeVO">
		DELETE FROM NOTICE WHERE NUM=#{num}
	</delete>	
	



</mapper>